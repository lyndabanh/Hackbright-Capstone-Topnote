{% extends 'base.html' %}

{% block title %}{{ wine.title }} - Details{% endblock %}

{% block body %}

<h3>{{ wine.title }}</h3>
<div class="row">
  <div class="col-4" offset=2>
    <img src="../static/images/maksym-kaharlytskyi-3uJt73tr4hI-unsplash.jpg">
    <div id="source">
      Photo by <a href="https://unsplash.com/@qwitka?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText">Maksym Kaharlytskyi</a> on <a href="https://unsplash.com/s/photos/wine?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText">Unsplash</a>
    </div>
  </div>
  <div class="col-4">
<p>
  <div>Designation: {{ wine.designation }}</div>
  <div>Varietal: {{ wine.variety }}</div>
  <div>Region 1: {{ wine.region_1 }}</div>
  <div>Region 2: {{ wine.region_2 }}</div>
  <div>Province: {{ wine.province }}</div>
  <div>Country: {{ wine.country }}</div>
  <div>Winery: {{ wine.winery }}</div>
</p>
  </div>
</div>

<p>
  <div>Description: {{ wine.description }}</div>
  <div>Critic Rating: {{ wine.points }}</div>
</p>


<h3>Reviews</h3>

{% if wine.ratings %}
<p>Average user rating: {{ average }}</p>
  {% if star_average == 1 %}
  <div>
    <i class="fas fa-star"></i>
  </div>
  {% elif star_average == 2 %}
  <div>
    <i class="fas fa-star"></i>
    <i class="fas fa-star"></i>
  </div>
  {% elif star_average == 3 %}
  <div>
    <i class="fas fa-star"></i>
    <i class="fas fa-star"></i>
    <i class="fas fa-star"></i>
  </div>
  {% elif star_average == 4 %}
  <div>
    <i class="fas fa-star"></i>
    <i class="fas fa-star"></i>
    <i class="fas fa-star"></i>
    <i class="fas fa-star"></i>
  </div>
  {% elif star_average == 5 %}
  <div>
    <i class="fas fa-star"></i>
    <i class="fas fa-star"></i>
    <i class="fas fa-star"></i>
    <i class="fas fa-star"></i>
    <i class="fas fa-star"></i>
  </div>
  {% endif %}
{%  endif %}




{% if num_favorites == 1 %}
  <p>This wine has been favorited {{ num_favorites }} time by: </p>
{% elif num_favorites > 1 %}
  <p>This wine has been favorited {{ num_favorites }} times by: </p>
{% else %}
  <p>This wine has not been favorited.</p>
{% endif %}

{% if num_favorites >= 1 %}
  {% for fav in favorites %}
  <a href="/users/{{ fav.user.user_id }}">{{ fav.user.name }}</a>
  {% endfor %}
{% endif %}

{% if not wine.ratings %}
<p>This wine does not have any ratings yet.</p>
{% endif %}

<h3>User reviews:</h3>

{% for rating in ratings %}
<div>{{ rating.user.name }}</div>
<div>{{ rating.rating }}</div>
{% endfor %}

<!-- <table>
<tr>
    <th>User</th>
    <th>Rating</th>
</tr>
{% for rating in wine.ratings %}
<tr>
    <td><a href="/users/{{ rating.user.user_id }}">{{ rating.user.name }}</a></td>
    <td>{{ rating.rating }}</td>
</tr>
{% endfor %}
</table> -->

{% if wine.ratings %}
<table>
    <tr>
        <th>User</th>
        <th>Rating(highest to lowest)</th>
    </tr>
    {% for rating in desc_ordered_ratings %}
    <tr>
        <td><a href="/users/{{ rating.user.user_id }}">{{ rating.user.name }}</a></td>
        <td>{{ rating.rating }}</td>
    </tr>
    {% endfor %}
</table>
{%  endif %}

<h2>Rate or Favorite this Wine!</h2>

{% if 'user_id' in session %}
{% if current_users_fav %}
  <form action="/wines/{{ wine.wine_id }}/ratings" method="POST">
    <p>
      <button type="submit" value="Unfavorite" name="unfavorite">Unfavorite</button>
    </p>
  {% else %}
  <form action="/wines/{{ wine.wine_id }}/ratings" method="POST">
    <p>
      <button type="submit" value="Favorite" name="favorite">Favorite</button>
    </p>
  {% endif %}

  {% if current_users_rating %}
  <p>You've already rated this wine. You may update your rating below:</p>
  <!-- <form action="/wines/{{ wine.wine_id }}/ratings" method="POST">
    <p>
      Update rating<input type="number" min="0" max=100 name="new_rating">
      Update comment<input type="text" name="new_comment">
    </p>
    <p>
      <input type="submit" value="Update">
    </p>
  </form> -->

  <form action="/wines/{{ wine.wine_id }}/ratings" method="POST">
    <div class="rating">
      <input type="radio" name="new_rating_star5" id="star5"><label for="star5"></label>
      <input type="radio" name="new_rating_star4" id="star4"><label for="star4"></label>
      <input type="radio" name="new_rating_star3" id="star3"><label for="star3"></label>
      <input type="radio" name="new_rating_star2" id="star2"><label for="star2"></label>
      <input type="radio" name="new_rating_star1" id="star1"><label for="star1"></label>
    </div>
    Add comment<input type="text" name="new_comment">
    <div>
      <input type="submit" value="Update">
    </div>
  </form>

  {% else %}
    <!-- <form action="/wines/{{ wine.wine_id }}/ratings" method="POST">
      <p>
        Rating<input type="number" min="0" max=100 name="rating">
        Add comment<input type="text" name="comment">
      </p>
      <p>
        <input type="submit" value="Rate">
      </p>
    </form> -->
    <form action="/wines/{{ wine.wine_id }}/ratings" method="POST">
      <div class="rating">
        <input type="radio" name="star5" id="star5"><label for="star5"></label>
        <input type="radio" name="star4" id="star4"><label for="star4"></label>
        <input type="radio" name="star3" id="star3"><label for="star3"></label>
        <input type="radio" name="star2" id="star2"><label for="star2"></label>
        <input type="radio" name="star1" id="star1"><label for="star1"></label>
      </div>
      Add comment<input type="text" name="comment">
      <div>
        <input type="submit" value="Rate">
      </div>
    </form>
  {% endif %}

{% endif %}

{% if not 'user_id' in session %}
  <p>
    <div><a href="/login_page">Log In</a> or <a href="/create_account_page">Create an Account</a> to view your friends' cellars!</div>
  </p>
{% endif %}

{% endblock %}